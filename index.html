<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Idea Note</title>
<link rel="manifest" href="manifest.json">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f7fa;
    padding: 20px;
  }
  .container {
    max-width: 700px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
  }
  textarea {
    width: 100%;
    height: 160px;
    padding: 10px;
  }
  button {
    margin-top: 10px;
    padding: 8px 14px;
    margin-right: 5px;
  }
  .item {
    padding: 12px;
    border-bottom: 1px solid #ddd;
  }
  .item-title {
    font-weight: bold;
    cursor: pointer;
  }
  .date {
    font-size: 12px;
    color: #666;
  }
  .hidden {
    display: none;
  }
</style>
</head>

<body>
<div class="container">

  <!-- ëª©ë¡ -->
  <div id="home">
    <h2>ğŸ“š ì•„ì´ë””ì–´ ëª©ë¡</h2>
    <button onclick="goWrite()">âœï¸ ìƒˆ ê¸€ ì‘ì„±</button>
    <button onclick="exportNotes()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
<button onclick="importNotes()">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
<input type="file" id="fileInput" accept=".json" hidden>

    <div id="list"></div>
  </div>

  <!-- ì‘ì„± / ìˆ˜ì • -->
  <div id="write" class="hidden">
    <h2 id="writeTitle">âœï¸ ê¸€ ì‘ì„±</h2>
    <textarea id="content"></textarea><br>
    <button onclick="save()">ì €ì¥</button>
    <button onclick="goHome()">ì·¨ì†Œ</button>
  </div>

</div>

<script>

// ğŸ“¤ ë‚´ë³´ë‚´ê¸°
function exportNotes() {
  const data = JSON.stringify(notes, null, 2);
  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "idea-note-backup.json";
  a.click();

  URL.revokeObjectURL(url);
}

// ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°
function importNotes() {
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", event => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    try {
      const imported = JSON.parse(e.target.result);

      if (!Array.isArray(imported)) {
        alert("ì˜¬ë°”ë¥¸ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");
        return;
      }

      if (!confirm("ê¸°ì¡´ ë©”ëª¨ë¥¼ ë®ì–´ì“¸ê¹Œìš”?")) return;

      notes = imported;
      localStorage.setItem("notes", JSON.stringify(notes));
      renderList();
      alert("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!");
    } catch {
      alert("íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  };

  reader.readAsText(file);
});

  
let notes = JSON.parse(localStorage.getItem("notes")) || [];
let editIndex = null;

function hideAll() {
  document.getElementById("home").classList.add("hidden");
  document.getElementById("write").classList.add("hidden");
}

function goHome() {
  hideAll();
  renderList();
  document.getElementById("home").classList.remove("hidden");
}

function goWrite() {
  editIndex = null;
  document.getElementById("content").value = "";
  document.getElementById("writeTitle").innerText = "âœï¸ ê¸€ ì‘ì„±";
  hideAll();
  document.getElementById("write").classList.remove("hidden");
}

function save() {
  const text = document.getElementById("content").value.trim();
  if (!text) return;

  if (editIndex === null) {
    notes.push({
      title: text.slice(0, 20) + (text.length > 20 ? "..." : ""),
      content: text,
      date: new Date().toLocaleString()
    });
  } else {
    notes[editIndex].content = text;
    notes[editIndex].title =
      text.slice(0, 20) + (text.length > 20 ? "..." : "");
    notes[editIndex].date = new Date().toLocaleString();
  }

  localStorage.setItem("notes", JSON.stringify(notes));
  goHome();
}

function renderList() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  notes.forEach((note, index) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="item-title" onclick="editNote(${index})">
        ${note.title}
      </div>
      <div class="date">${note.date}</div>
      <button onclick="deleteNote(${index})">ì‚­ì œ</button>
    `;
    list.prepend(div);
  });
}

function editNote(index) {
  editIndex = index;
  document.getElementById("content").value = notes[index].content;
  document.getElementById("writeTitle").innerText = "âœï¸ ê¸€ ìˆ˜ì •";
  hideAll();
  document.getElementById("write").classList.remove("hidden");
}

function deleteNote(index) {
  if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
  notes.splice(index, 1);
  localStorage.setItem("notes", JSON.stringify(notes));
  renderList();
}

goHome();

// PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>


